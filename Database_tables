CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL
);

CREATE TABLE media_entries (
    media_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    media_type VARCHAR(20) CHECK (media_type IN ('movie','series','game')),
    release_year INT,
    age_restriction INT,
    genre_id INT NOT NULL REFERENCES genres(genre_id) ON DELETE CASCADE
);

CREATE TABLE genres (
    genre_id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE ratings (
    rating_id SERIAL PRIMARY KEY,
    media_id INT NOT NULL REFERENCES media_entries(media_id) ON DELETE CASCADE,
    user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    stars INT CHECK (stars BETWEEN 1 AND 5),
    comment TEXT,
    confirmed BOOLEAN DEFAULT FALSE
);

CREATE TABLE rating_likes (
    rating_likes_id SERIAL PRIMARY KEY,
    rating_id INT NOT NULL REFERENCES ratings(rating_id) ON DELETE CASCADE,
    user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE
);

CREATE TABLE favorites (
    favorites_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    media_id INT NOT NULL REFERENCES media_entries(media_id) ON DELETE CASCADE
);

CREATE TABLE auth_tokens (
    token_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    token VARCHAR(255) UNIQUE NOT NULL
);
